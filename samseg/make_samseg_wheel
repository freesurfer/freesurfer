#!/usr/bin/env bash

readonly MAKE_SAMSEG_PROGRAM_NAME=$(basename $0)

make_samseg_main() {
    local visualization_arg=''
    local parsed_commandline=$(getopt -o hn --long 'help,no-visualization' -- "$@")
    eval set -- "${parsed_commandline}"
    while true ; do
        case "$1" in
            -h|--help)
                make_samseg_usage
                exit 0
                ;;
            -n|--no-visualization)
                visualization_arg="--no-visualization"
                echo "Setting visualization off"
                shift
                ;;
             --)
                shift
                break
                ;;
        esac
    done
    if [[ 0 != $# ]]; then
        echo "unknown arguments $@"
        make_samseg_usage
        exit 1
    fi
    python setup.py bdist_wheel $visualization_arg && pip install dist/*.whl

}

make_samseg_usage() {
cat <<-EOF
usage: $MAKE_SAMSEG_PROGRAM_NAME options

Makes and then installs samseg packages.

OPTIONS:
    -h, --help               Print this usage message
    -n, --no-visualization   Builds with no visualization and no dependency on Qt5
                             Default is to include visualization

Examples:
    Make with visualization:
    $MAKE_SAMSEG_PROGRAM_NAME

    Make with no visualization:
    $MAKE_SAMSEG_PROGRAM_NAME -n

EOF
}

make_samseg_main "$@"